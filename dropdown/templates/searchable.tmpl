{{define "lvt:dropdown:searchable:v1"}}
{{if .IsStyled}}
{{/* Tailwind CSS styled version */}}
<div class="relative inline-block w-full" data-dropdown="{{.ID}}">
  <div class="relative">
    <input
      type="text"
      class="w-full px-4 py-2 pr-10 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:bg-gray-100 disabled:cursor-not-allowed"
      placeholder="{{.Placeholder}}"
      value="{{.Query}}"
      lvt-input="search_{{.ID}}"
      lvt-debounce="150"
      lvt-focus="open_{{.ID}}"
      {{if .Disabled}}disabled{{end}}
      autocomplete="off"
      aria-haspopup="listbox"
      aria-expanded="{{.Open}}"
      {{if .Open}}lvt-autofocus{{end}}
    />
    {{if .Query}}
    <button
      type="button"
      class="absolute inset-y-0 right-8 flex items-center pr-2 text-gray-400 hover:text-gray-600"
      lvt-click="clear_search_{{.ID}}"
    >
      <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
      </svg>
    </button>
    {{end}}
    <span class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
      <svg class="w-5 h-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
      </svg>
    </span>
  </div>

  {{if .Open}}
  <div
    class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto"
    lvt-click-away="close_{{.ID}}"
    role="listbox"
  >
    {{$visibleOptions := .VisibleOptions}}
    {{if $visibleOptions}}
    {{range $visibleOptions}}
    <div
      class="px-4 py-2 cursor-pointer hover:bg-blue-50 {{if .Disabled}}opacity-50 cursor-not-allowed{{end}} {{if and $.Selected (eq $.Selected.Value .Value)}}bg-blue-100{{end}}"
      lvt-click="select_{{$.ID}}"
      lvt-data-value="{{.Value}}"
      role="option"
      {{if .Disabled}}aria-disabled="true"{{end}}
      {{if and $.Selected (eq $.Selected.Value .Value)}}aria-selected="true"{{end}}
    >
      {{.Label}}
    </div>
    {{end}}
    {{else}}
    <div class="px-4 py-2 text-gray-500 text-sm">
      No results found
    </div>
    {{end}}
  </div>
  {{end}}
</div>
{{else}}
{{/* Unstyled semantic HTML version */}}
<div data-dropdown="{{.ID}}">
  <div>
    <input
      type="text"
      placeholder="{{.Placeholder}}"
      value="{{.Query}}"
      lvt-input="search_{{.ID}}"
      lvt-debounce="150"
      lvt-focus="open_{{.ID}}"
      {{if .Disabled}}disabled{{end}}
      autocomplete="off"
      aria-haspopup="listbox"
      aria-expanded="{{.Open}}"
      {{if .Open}}lvt-autofocus{{end}}
    />
    {{if .Query}}
    <button type="button" lvt-click="clear_search_{{.ID}}">Clear</button>
    {{end}}
  </div>

  {{if .Open}}
  <div lvt-click-away="close_{{.ID}}" role="listbox">
    {{$visibleOptions := .VisibleOptions}}
    {{if $visibleOptions}}
    {{range $visibleOptions}}
    <div
      lvt-click="select_{{$.ID}}"
      lvt-data-value="{{.Value}}"
      role="option"
      {{if .Disabled}}aria-disabled="true"{{end}}
    >
      {{.Label}}
    </div>
    {{end}}
    {{else}}
    <div>No results found</div>
    {{end}}
  </div>
  {{end}}
</div>
{{end}}
{{end}}
